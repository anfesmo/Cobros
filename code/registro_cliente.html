<!DOCTYPE HTML>
<html lang="es">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="images/splash/splash-icon.png">
    <link rel="apple-touch-startup-image" href="images/splash/splash-screen.png" media="screen and (max-device-width: 320px)" />
    <link rel="apple-touch-startup-image" href="images/splash/splash-screen@2x.png" media="(max-device-width: 480px) and (-webkit-min-device-pixel-ratio: 2)" />
    <link rel="apple-touch-startup-image" sizes="640x1096" href="images/splash/splash-screen@3x.png" />
    <link rel="apple-touch-startup-image" sizes="1024x748" href="images/splash/splash-screen-ipad-landscape"
        media="screen and (min-device-width : 481px) and (max-device-width : 1024px) and (orientation : landscape)" />
    <link rel="apple-touch-startup-image" sizes="768x1004" href="images/splash/splash-screen-ipad-portrait.png"
        media="screen and (min-device-width : 481px) and (max-device-width : 1024px) and (orientation : portrait)" />
    <link rel="apple-touch-startup-image" sizes="1536x2008" href="images/splash/splash-screen-ipad-portrait-retina.png"
        media="(device-width: 768px)  and (orientation: portrait) and (-webkit-device-pixel-ratio: 2)" />
    <link rel="apple-touch-startup-image" sizes="1496x2048" href="images/splash/splash-screen-ipad-landscape-retina.png"
        media="(device-width: 768px) and (orientation: landscape)    and (-webkit-device-pixel-ratio: 2)" />
    <title>Gestión VC</title>
    <link href="styles/style.css" rel="stylesheet" type="text/css">
    <link href="styles/framework.css" rel="stylesheet" type="text/css">
    <link href="styles/owl.carousel.css" rel="stylesheet" type="text/css">
    <link href="styles/owl.theme.css" rel="stylesheet" type="text/css">
    <link href="styles/swipebox.css" rel="stylesheet" type="text/css">
    <link href="styles/colorbox.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="scripts/jquery.js"></script>
    <script type="text/javascript" src="scripts/jqueryui.js"></script>
    <script type="text/javascript" src="scripts/owl.carousel.min.js"></script>
    <script type="text/javascript" src="scripts/jquery.swipebox.js"></script>
    <script type="text/javascript" src="scripts/colorbox.js"></script>
    <script type="text/javascript" src="scripts/snap.js"></script>
    <script type="text/javascript" src="scripts/contact.js"></script>
    <script type="text/javascript" src="scripts/custom.js"></script>
    <script type="text/javascript" src="scripts/framework.js"></script>
    <script type="text/javascript" src="scripts/framework.launcher.js"></script>
    <script type="text/javascript" src="http://pajhome.org.uk/crypt/md5/2.2/md5-min.js"></script>
    <script type="text/javascript" src="scripts/bd.js"></script>

</head>
<body>
    <div id="preloader">
        <div id="status">
            <p class="center-text">
                Cargando contenido... <em>La carga depende de su conexión a internet!</em>
            </p>
        </div>
    </div>
    <div class="all-elements">
        <div id="sidebar" class="page-sidebar">
            <div class="page-sidebar-scroll">
                <div class="sidebar-shortcuts">
				    <a href="#" class="shortcut-closedsession" title="Cerrar Sesión" onclick="closedSession();"></a>
                    <a href="#" class="shortcut-close"></a>
                </div>
                
                <div class="sidebar-search">
                    <div class="search-box">
                        <input type="text" class="search-field" name="search" onfocus="if(this.value == 'Looking for something?') { this.value = ''; }" value="Looking for something?"                        
						<a href="#" class="search-close"></a>
                    </div>
                </div>
                
                <div class="sidebar-logo">
                    <img src="images/drugs/logo_odc.png" height="80" alt="img">
                </div>
                
                <div class="sidebar-breadcrumb">NAVEGACIÓN</div>
                <div class="sidebar-decoration"></div>
                <div class="navigation-item">
                    <a href="inicio-sesion.html" class="nav-item home-locales">Sincronizar<em class="unselected-item"></em></a>
                </div>
                <div class="sidebar-decoration"></div>
                <div class="navigation-item">
                    <a href="registro_cliente.html" class="nav-item home-locales">Registrar cliente<em class="unselected-item"></em></a>
                </div>
				<div class="sidebar-decoration"></div>
				<div class="navigation-item">
                    <a href="lista_clientes.html" class="nav-item home-locales">Listado Clientes<em class="unselected-item"></em></a>
                </div>
				<div class="sidebar-decoration"></div>
				<div class="navigation-item">
                    <a href="reporte_preliquidacion.html" class="nav-item home-locales">Preliquidación<em class="unselected-item"></em></a>
                </div>
				<div class="sidebar-decoration"></div>
				<div class="navigation-item">
                    <a href="recaudos_prestamos_registrados.html" class="nav-item home-locales">Recaudos y Prestamos<em class="unselected-item"></em></a>
                </div>
                <div class="sidebar-decoration"></div>                
                <div class="sidebar-breadcrumb">
                </div>
            </div>         
        </div>
     
        <div id="content" class="page-content">
            <div class="page-header">
                <a href="#" class="deploy-sidebar"></a>
                <img class="header-logo" src="images/drugs/odc-texto.png" width="71" alt="img">
            </div>            
            <div class="content">
                <div class="decoration">
                </div>
				<div class="page-header-clear">
				</div>
				<div class="container no-bottom" style="text-align: center;">
					<h3>
						REGISTRO DE CLIENTES</h3>
				</div>
				<div class="decoration">
				</div>
				<div class="container no-bottom">
					<div class="big-notification blue-notification">
						<h4 class="uppercase">
							AYUDA</h4>
						<a href="#" class="close-big-notification">x</a>
						<p>
							En este módulo podrá registrar la información para la creación de nuevos clientes.
						</p>
					</div>
				</div>
                <div class="container no-bottom">
                    <form method="post" class="contactForm" id="contactForm" style="display: block !important;" >
                    <fieldset>
                        <div class="formFieldWrap">
                            <label class="field-title contactNameField" for="contactNameField">
                                Tipo de documento:<span>(requerido)</span></label>
                            <select class="styled-select" name="selectTipo" id="selectTipo">
                                <option value='1'>Cédula</option>
                                <option value='2'>Cédula Extranjería</option>
                                <option value='3'>Pasaporte</option>
                                <option value='4'>Tarjeta de Identidad</option>
                            </select>
                        </div>
                        <div class="formFieldWrap">
                            <label class="field-title contactEmailField" for="contactEmailField">
                                Número de documento:<span>(requerido)</span></label>
                            <input type="numeric" name="txtDocumento" value="" class="contactField requiredField"
                                id="txtDocumento" min="0" max="1000000000" required autofocus/>
                        </div>
                        <div class="formFieldWrap">
                            <label class="field-title contactEmailField" for="contactEmailField">
                                Nombres:<span>(requerido)</span></label>
                            <input type="text" name="txtNombres" value="" class="contactField requiredField"
                                id="txtNombres" />
                        </div>
                        <div class="formFieldWrap">
                            <label class="field-title contactEmailField" for="contactEmailField">
                                Apellidos:<span>(requerido)</span></label>
                            <input type="text" name="txtApellidos" value="" class="contactField requiredField"
                                id="txtApellidos" />
                        </div>                       
                        <div class="formFieldWrap">
                            <label class="field-title contactEmailField" for="contactEmailField">
                                Fecha de nacimiento:</label>
                            <input type="text" placeholder="AAAA/MM/DD" name="txtFecha" value="2000/01/01" class="contactField requiredField"
                                id="txtFecha" />
                        </div>
                        <div class="formFieldWrap">
                            <label class="field-title contactEmailField" for="contactEmailField">
                                Sexo:<span>(requerido)</span></label>
                            <select class="styled-select" name="selectSexo" id="selectSexo">
                                <option value='1'>Masculino</option>
                                <option value='2'>Femenino</option>
                            </select>
                        </div>
                        <div class="formFieldWrap">
                            <label class="field-title contactEmailField" for="contactEmailField">
                                Teléfono:<span>(requerido)</span></label>
                            <input type="text" name="txtTelefono" value="" class="contactField requiredField"
                                id="txtTelefono" />
                        </div>
                        <div class="formFieldWrap">
                            <label class="field-title contactEmailField" for="contactEmailField">
                                Celular:<span>(requerido)</span></label>
                            <input type="text" name="txtCelular" value="" class="contactField requiredField"
                                id="txtCelular" />
                        </div>
                        <div class="formFieldWrap">
                            <label class="field-title contactEmailField" for="contactEmailField">
                                Dirección:<span>(requerido)</span></label>
                            <input type="text" name="txtDireccion" value="" class="contactField requiredField"
                                id="txtDireccion" />
                        </div>
                        <div class="formFieldWrap">
                            <label class="field-title contactEmailField" for="contactEmailField">
                                Correo:</label>
                            <input type="text" name="txtCorreo" value="" class="contactField requiredField"
                                id="txtCorreo" />
                        </div>
                        <br />
                        <div class="formSubmitButtonErrorsWrap">
                            <input type="submit" class="buttonWrap button button-dark contactSubmitButton" id="contactSubmitButton"
                                value="Enviar" data-formid="contactForm" onclick="MM_validateForm('selectTipo','','R','txtDocumento','','R','txtNombres','','R','txtApellidos','','R','selectSexo','','R','txtTelefono','','R','txtCelular','','R','txtDireccion','','R','txtCorreo','','isEmail');return document.MM_returnValue" />
                        </div>
                    </fieldset>
                    </form>
                </div>
                <div class="decoration">
                </div>
                <div id="loading" class="CargandoModalBackground">
                    <img src="images/bx_loader.gif" alt="loding" class="CargandoModalBackgroundImage" />
                </div>
                <div class="container">
                   <center> 2014 &copy; Todos los Derechos Reservados.</center>
                </div>
            </div>
        </div>
        
    </div>
    <script type="text/javascript">
        $( document ).ready(function() {            
		  if(sessionStorage.getItem("estadoLogin") == "Exitoso"){
			  configurar_db();
		  }else{
				location.href = "index.html";
			}
        });
		
		function closedSession(){
		    sessionStorage.setItem("estadoLogin", "");
			location.href = "index.html";
		}
		
        var cliente = {nombre:"", cedula:"", telefono:"", CodCliente:0, CodGestor:"", CodPrestamo:"", FechaPrestamo:"", FechaVencimientoPrestamo:"", NroCuotasPrestamo:"", NroCuotasResta:"", VlrCuota:"", VlrIntreses:"", VlrPrestamo:"", VlrSaldoConInteres:"", VlrSaldoSinInteres:""};
        var clientes = [];

        function validarFormatoFecha(campo) {
              var RegExPattern = /^\d{2,4}\/\d{1,2}\/\d{1,2}$/;
              if ((campo.match(RegExPattern)) && (campo!='')) {
                    return true;
              } else {
                    return false;
              }
        }

		function validarCaracteresEspeciales(campo) {
              var RegExPattern = /^[\s\da-zA-Z-]*$/;
              if ((campo.match(RegExPattern)) && (campo!='')) {
                    return true;
              } else {
                    return false;
              }
        }
		
        function guardarCliente(){            
            if(validarFormatoFecha($('#txtFecha').val())){
			  if(validarCaracteresEspeciales($('#txtDireccion').val())){
				if(parseInt(localStorage.getItem("idGestor")) > 0 ){	               
                var url = "https://23.253.187.200:50002/ServiceCobros.svc/getCrearCliente?para_tipoident100="+$('#selectTipo').val()+"&clie_nroidentifica="+$('#txtDocumento').val()+"&clie_nombres="+$('#txtNombres').val()+"&clie_apellidos="+$('#txtApellidos').val()+"&clie_fecnacimiento="+$('#txtFecha').val()+"&para_sexo101="+$('#selectSexo').val()+"&clie_telfijo="+$('#txtTelefono').val()+"&clie_movil="+$('#txtCelular').val()+"&clie_diresidencia="+$('#txtDireccion').val()+"&clie_email="+$('#txtCorreo').val()+"&gest_id="+localStorage.getItem("idGestor");

                    $.ajax({
                        url: url,
                        type: 'GET',
                        dataType: 'json',
                        crossDomain: true,
                        success: function (data) {

                            $.each(data, function (i, field) {                                
                                $.each(field, function (x, item) {
									cliente = {nombre:field[x].Nombres, cedula:field[x].NroIdentificacion, telefono:field[x].Telefono, CodCliente:field[x].CodCliente, CodGestor:field[x].CodGestor, CodPrestamo:field[x].CodPrestamo, FechaPrestamo:field[x].FechaPrestamo, FechaVencimientoPrestamo:field[x].FechaVencimientoPrestamo, NroCuotasPrestamo:field[x].NroCuotasPrestamo, NroCuotasResta:field[x].NroCuotasResta, VlrCuota:field[x].VlrCuota, VlrIntreses:field[x].VlrIntreses, VlrPrestamo:field[x].VlrPrestamo, VlrSaldoConInteres:field[x].VlrSaldoConInteres, VlrSaldoSinInteres:field[x].VlrSaldoSinInteres};
                                    clientes[x] = cliente;
                                });
                                insertarClientes();
                            });
                        },
                        error: function (x, y, z) {
                            OcultarDivCargando();
                        }, 
                        timeout: 15000                          
                    });
				}else{
				  alert("El codigo de Gestor se ha perdido, para poder crear el cliente debe sincronizar");
				}
			  }else{
				alert("La dirección no puede contener los siguientes caracteres especiales # $ % &");
			  }
			}
            else{
                alert("La fecha la debe ingresar en formato AAAA/MM/DD");
            }
        
        }

        function errorGeneralBD(err) {
            console.log(err);
        }

        function insertarClientes(){
            var db = window.openDatabase("bd_cobros", "1.0", "Gestion cobros", 200000);
            db.transaction(insertar_Clientes, errorGeneralBD, function () {
                console.log("Consultó el cliente")
            });
        }

        function insertar_Clientes(tx) {
            if(clientes.length > 0){
                for(i=0;i<clientes.length;i++){
                    tx.executeSql("INSERT INTO clientes (CodCliente, Nombre, Telefono, NroIdentificacion, CodGestor, CodPrestamo, FechaPrestamo, FechaVencimientoPrestamo, NroCuotasPrestamo, NroCuotasResta, VlrCuota, VlrIntreses, VlrPrestamo, VlrSaldoConInteres, VlrSaldoSinInteres, esNuevo, Latitud, Longitud) VALUES ('"+clientes[i].CodCliente+"', '"+clientes[i].nombre+"', '"+clientes[i].telefono+"', '"+clientes[i].cedula+"', '"+clientes[i].CodGestor+"', '"+clientes[i].CodPrestamo+"', '"+clientes[i].FechaPrestamo+"', '"+clientes[i].FechaVencimientoPrestamo+"', '"+clientes[i].NroCuotasPrestamo+"', '"+clientes[i].NroCuotasResta+"', '"+clientes[i].VlrCuota+"', '"+clientes[i].VlrIntreses+"', '"+clientes[i].VlrPrestamo+"', '"+clientes[i].VlrSaldoConInteres+"', '"+clientes[i].VlrSaldoSinInteres+"', '0','','')");
                }

                OcultarDivCargando();
                alert("El cliente ha sido registrado exitosamente.")
                localStorage.setItem("idGestor", localStorage.getItem("idGestor"));
                location.href = "lista_clientes.html";
            }
            else{
                OcultarDivCargando();
            }

        }
		// Función para validar los campos del formulario de registro de clientes
		function MM_validateForm() { //v4.0		
		  if (document.getElementById){
			var i,p,q,nm,test,num,min,max,errors='',args=MM_validateForm.arguments;
			for (i=0; i<(args.length-2); i+=3) { test=args[i+2]; val=document.getElementById(args[i]);
			  if (val) { nm=val.name; if ((val=val.value)!="") {
				if (test.indexOf('isEmail')!=-1) { p=val.indexOf('@');
				  if (p<1 || p==(val.length-1)) errors+='- '+nm.slice(3,20)+' debe contener una dirección de correo electrónica.\n';
				} else if (test!='R') { num = parseFloat(val);
				  if (isNaN(val)) errors+='- '+nm.slice(3,20)+' debe contener un número.\n';
				  if (test.indexOf('inRange') != -1) { p=test.indexOf(':');
					min=test.substring(8,p); max=test.substring(p+1);
					if (num<min || max<num) errors+='- '+nm.slice(3,20)+' debe contener un número entre '+min+' y '+max+'.\n';
			  } } } else if (test.charAt(0) == 'R') errors += '- '+nm.slice(3,20)+' es requerido.\n'; }
			} 			
			if (errors) alert('Los siguientes erro(s) ocurrieron:\n'+errors); else{guardarCliente();}
			document.MM_returnValue = (errors == '');
		}}

    </script>
    <style>
        #contactNameField {
            text-transform: none;
        }

        .submenu-nav-items a
        {
            padding-left: 20px !important;
            padding-top: 10px !important;
            padding-bottom: 10px !important;
            border-bottom: solid 1px rgba(0,0,0,0.1) !important;
        }
        
        .vinculo_derecha
        {
            float: right;
            padding-right: 1%;
        }
        
        .vinculo_izquierda
        {
            float: left;
            padding-left: 1%;
            display: none;
        }
        
        .CargandoModalBackground
        {
            overflow: hidden;
            background-color: #0D0D0D;
            filter: alpha(opacity=90);
            opacity: 0.9;
            position: fixed;
            top: 0px;
            left: 0px;
            text-align: center;
            vertical-align: middle;
            width: 100%;
            height: 100%;
            display: none;
            z-index: 9999;
            color: white;
            text-align: left;
        }
        
        .styled-select
        {
            width: 95%;
            height: 34px;
            overflow: hidden;
            background: url(images/flecha_abajo.png) no-repeat right #F4F4F4;
            padding: 3px;
            margin: 5px;
            -webkit-border-radius: 4px;
            -moz-border-radius: 4px;
            border-radius: 4px;
            -webkit-box-shadow: 0 3px 0 #ccc, 0 -1px #fff inset;
            -moz-box-shadow: 0 3px 0 #ccc, 0 -1px #fff inset;
            box-shadow: 0 3px 0 #ccc, 0 -1px #fff inset;
            color: #888;
            border: none;
            outline: none;
            display: inline-block;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            cursor: pointer;
        }
    </style>
</body>
</html>
